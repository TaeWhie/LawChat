# 노동법 챗봇 시나리오 테스트 개선 완료 요약

## 완료된 개선 사항

### 1. 이슈 카테고리 확장 ✅
**파일**: `rag/labor_keywords.py`

- `PRIMARY_ISSUES`에 다음 이슈 추가:
  - `산재` (산업재해보상보험법)
  - `산업안전` (산업안전보건법)
  - `노조` (노동조합 및 노동관계조정법)
  - `최저임금` (최저임금법)
  - `남녀고용평등` (남녀고용평등법)
  - `육아휴직` (남녀고용평등법)
  - `고용보험` (고용보험법)

### 2. 이슈 동의어 확장 ✅
**파일**: `rag/labor_keywords.py`

- `ISSUE_SYNONYMS`에 관련 동의어 추가:
  - 산재: "산재", "산업재해", "업무상재해", "업무상재해보상", "산재보험"
  - 산업안전: "산업안전", "작업중지", "작업중지권", "안전보건"
  - 노조: "노조", "노동조합", "부당노동행위", "단체교섭"
  - 최저임금: "최저임금", "수습기간"
  - 남녀고용평등: "남녀고용평등", "성차별"
  - 육아휴직: "육아휴직"

### 3. 프롬프트 개선 ✅
**파일**: `rag/prompts.py`

#### 이슈 분류 프롬프트
- 새로운 이슈 카테고리를 명시적으로 언급하도록 업데이트

#### 체크리스트 프롬프트
- 이슈별 필수 확인 사항 추가:
  - 최저임금: 계약 기간(1년 이상?), 업무 유형(단순 노무 업무?)
  - 육아휴직: 사용자의 휴직 신청에 대한 사업주 응답, 복귀 후 직무 보장
  - 산재: 사업주 동의 요건(필요 없음 명시)
  - 산업안전/작업중지권: 위험한 작업 조건, 작업 거부 권리
  - 노조: 노조 활동, 사업주의 응답/협박

#### 결론 생성 프롬프트
- 법률명 포함 강화: 조문 인용 시 반드시 법률명 포함 (예: "근로기준법 제36조")
- 이슈별 핵심 법리 명시:
  - 최저임금: "1년 이상 계약 기간", "단순 노무 업무 여부" 조건
  - 육아휴직: "동일 업무 또는 동일 임금 수준의 직무 복귀" 의무
  - 산재: "사업주 동의 불필요", "근로복지공단 접수" 절차
  - 작업중지권: "작업중지권", "불이익 금지" 명시
  - 부당노동행위: "부당노동행위", "노동위원회 구제 절차"

### 4. 이슈별 법률 매핑 추가 ✅
**파일**: `rag/pipeline.py`

- `ISSUE_TO_LAW_MAPPING` 딕셔너리 추가:
  ```python
  ISSUE_TO_LAW_MAPPING = {
      "최저임금": [SOURCE_MIN_WAGE_LAW, SOURCE_LAW],
      "산재": [SOURCE_INDUSTRIAL_ACCIDENT_LAW, SOURCE_SAFETY_LAW, SOURCE_LAW],
      "산업안전": [SOURCE_SAFETY_LAW, SOURCE_INDUSTRIAL_ACCIDENT_LAW],
      "노조": [SOURCE_UNION_LAW],
      "남녀고용평등": [SOURCE_GENDER_EQUALITY_LAW, SOURCE_LAW],
      "육아휴직": [SOURCE_GENDER_EQUALITY_LAW, SOURCE_LAW],
      "퇴직금": [SOURCE_RETIREMENT_LAW, SOURCE_LAW],
      "고용보험": [SOURCE_LAW],
  }
  ```

- `_collect_articles_by_issue` 함수 개선:
  - 이슈별로 관련 법률을 우선 검색
  - 관련 법률에서 충분한 결과가 없으면 전체 법률에서 추가 검색

### 5. RAG 컨텍스트에 법률명 자동 포함 ✅
**파일**: `rag/pipeline.py`

- `_rag_context` 함수 개선:
  - 조문 표시 시 법률명 자동 포함
  - 형식: `[법률명] [장] 조문번호\n본문`
  - 예: `[근로기준법] [제3장 임금] 제36조(임금의 지급)\n본문...`

### 6. 시나리오 테스트 스크립트 생성 ✅
**파일**: `scripts/test_scenarios.py`

- 10개 시나리오 자동 테스트
- 각 시나리오별로:
  - 이슈 분류 테스트
  - 체크리스트 생성 테스트
  - 결론 생성 테스트
  - 예상 조문/법률 검증
  - 점수 계산 및 누락 항목 분석

## 시나리오별 예상 개선 효과

### 시나리오 1-5: 근로기준법 중심
- ✅ 이슈 분류 정확도 향상
- ✅ 조문 검색 범위 확대 (시행령/시행규칙 포함)
- ✅ 결론에 법률명 자동 포함

### 시나리오 6: 최저임금법
- ✅ "최저임금" 이슈로 정확히 분류
- ✅ 최저임금법 우선 검색
- ✅ 체크리스트에서 계약 기간/업무 유형 확인
- ✅ 결론에서 조건 명시

### 시나리오 7: 남녀고용평등법
- ✅ "육아휴직" 이슈로 정확히 분류
- ✅ 남녀고용평등법 우선 검색
- ✅ 체크리스트에서 복귀 직무 보장 확인
- ✅ 결론에서 복귀 의무 명시

### 시나리오 8: 산재보험법
- ✅ "산재" 이슈로 정확히 분류
- ✅ 산재보험법 우선 검색
- ✅ 체크리스트에서 사업주 동의 불필요 확인
- ✅ 결론에서 신청 절차 명시

### 시나리오 9: 산업안전보건법
- ✅ "산업안전" 이슈로 정확히 분류
- ✅ 산업안전보건법 우선 검색
- ✅ 체크리스트에서 작업중지권 확인
- ✅ 결론에서 작업중지권과 불이익 금지 명시

### 시나리오 10: 노조법
- ✅ "노조" 이슈로 정확히 분류
- ✅ 노조법 우선 검색
- ✅ 체크리스트에서 부당노동행위 확인
- ✅ 결론에서 부당노동행위와 구제 절차 명시

## 테스트 실행 방법

```bash
python scripts/test_scenarios.py
```

결과는 `scenario_test_results_YYYYMMDD_HHMMSS.json` 파일로 저장됩니다.

## 다음 단계 (선택 사항)

1. **시뮬레이션 결과 분석**
   - 누락된 조문/법률 패턴 파악
   - 점수 낮은 시나리오 집중 개선

2. **체크리스트 질문 품질 개선**
   - 이슈별 필수 확인 사항을 더 구체적으로 질문
   - LLM이 생성한 질문의 품질 검증

3. **결론 생성 품질 개선**
   - 법률명 포함 비율 모니터링
   - 핵심 법리 명시 비율 모니터링

4. **벡터 스토어 동기화 확인**
   - 모든 법률이 벡터 스토어에 포함되어 있는지 확인
   - 누락된 법률이 있으면 동기화 실행

## 주요 변경 파일 목록

1. `rag/labor_keywords.py` - 이슈 카테고리 및 동의어 확장
2. `rag/prompts.py` - 프롬프트 개선 (이슈 분류, 체크리스트, 결론)
3. `rag/pipeline.py` - 이슈별 법률 매핑, RAG 컨텍스트 개선
4. `scripts/test_scenarios.py` - 시나리오 테스트 스크립트 (신규)
5. `docs/SCENARIO_IMPROVEMENTS.md` - 개선 사항 상세 문서 (신규)
6. `docs/SCENARIO_TEST_SUMMARY.md` - 이 문서 (신규)
