# 구조적 개선 사항 (하드코딩 제거)

## 개선 원칙

하드코딩된 매핑을 제거하고, **동적 검색 전략**과 **품질 검증 파이프라인**으로 대체했습니다.

## 주요 변경 사항

### 1. 하드코딩 제거 ✅

**이전 방식 (제거됨):**
```python
ISSUE_CRITICAL_ARTICLES = {
    "최저임금": {SOURCE_MIN_WAGE_LAW: ["제5조"]},
    "산재": {SOURCE_INDUSTRIAL_ACCIDENT_LAW: ["제37조"]},
    ...
}
```

**새로운 방식:**
- 하드코딩된 매핑 완전 제거
- 동적 검색 품질 검증으로 대체

### 2. 새로운 모듈: `rag/article_enrichment.py` ✅

**기능:**
- `validate_search_quality()`: 검색 결과의 품질을 동적으로 평가
  - 조문 수 충분성
  - 법률 다양성
  - 품질 점수 계산 (0.0 ~ 1.0)
  
- `enrich_articles_with_expanded_search()`: 검색 결과가 부족할 때 확장 검색
  - 전략 1: 이슈명 + 상황으로 넓게 재검색
  - 전략 2: API를 통한 관련 조문 확장
  - 전략 3: 검색된 조문의 관련 조문 추적

### 3. 파이프라인 단계 추가 ✅

#### Step 1: 이슈 분류 후 조문 검색 품질 검증
- 검색된 조문의 품질을 평가
- 품질이 낮으면 자동으로 확장 검색 수행

#### Step 2: 체크리스트 생성 실패 시 재시도 전략
- 컨텍스트가 없을 때:
  1. 확장 검색 전략 적용
  2. 이슈명만으로 넓게 검색
  3. 여전히 없으면 에러 반환

#### Step 3: 결론 생성 전 검색 품질 재검증
- 검색 결과의 품질을 재평가
- 부족하면 확장 검색으로 보완
- 보완 후 컨텍스트 재생성

### 4. 검색 전략 개선 ✅

**이슈별 관련 법률 우선 검색:**
- `ISSUE_TO_LAW_MAPPING` 활용 (이것은 구조적 매핑이므로 유지)
- 관련 법률에서 먼저 검색
- 부족하면 전체 법률에서 추가 검색

**동적 보완:**
- 검색 품질이 낮으면 자동으로 확장 검색
- API를 통한 관련 조문 확장
- 검색된 조문의 관련 조문 추적

## 개선 효과

1. **유지보수성 향상**
   - 하드코딩 제거로 새로운 이슈 추가 시 코드 수정 불필요
   - 검색 전략만으로 자동 처리

2. **확장성 향상**
   - 새로운 법률 추가 시 자동으로 검색 범위에 포함
   - 이슈별 필수 조문을 수동으로 관리할 필요 없음

3. **견고성 향상**
   - 검색 실패 시 자동 재시도
   - 품질 검증으로 부족한 결과 자동 보완

## 다음 단계

1. 시뮬레이션 결과 확인
2. 품질 점수 임계값 조정 (필요 시)
3. 확장 검색 전략 추가 (필요 시)
