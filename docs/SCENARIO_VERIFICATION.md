# 10개 시나리오 검증 요약

## 테스트 실행 방법

```bash
cd D:\PhythonProject\LawChat
python scripts/test_scenarios.py
```

- 벡터 스토어 자동 로드 후, 10개 시나리오에 대해 Step1(이슈 분류) → Step2(체크리스트) → Step3(결론) 순으로 실행됩니다.
- 결과는 `scenario_test_results_YYYYMMDD_HHMMSS.json` 으로 저장됩니다.
- 콘솔 인코딩 문제 시: `chcp 65001` 후 실행하거나, 결과 JSON만 확인해도 됩니다.

## 시나리오 목록 및 기대 조문/법률

| ID | 시나리오명 | 예상 이슈 | 예상 조문 | 예상 법률 |
|----|------------|------------|-----------|-----------|
| 1 | 부당해고 및 해고 예고 | 해고/징계 | 제23조, 제26조, 제27조 | 근로기준법 |
| 2 | 직장 내 괴롭힘 | 직장 내 괴롭힘 | 제76조의2, 제76조의3 | 근로기준법 |
| 3 | 임금 체불·퇴직금 지급 기한 | 퇴직금, 임금 | 제36조 | 근로기준법, 근로자퇴직급여 보장법 |
| 4 | 포괄임금제·연장근로 수당 | 근로시간, 임금 | 제56조 | 근로기준법 |
| 5 | 5인 미만 사업장 적용 범위 | 휴일/휴가 | 제11조 | 근로기준법 |
| 6 | 최저임금·수습기간 | 최저임금 | 제5조 | 최저임금법 |
| 7 | 육아휴직·불이익 금지 | 육아휴직 | 제19조 | 남녀고용평등과 일·가정 양립 지원에 관한 법률 |
| 8 | 산재 신청·사업주 동의 | 산재 | 제37조 | 산업재해보상보험법 |
| 9 | 산업안전·작업중지권 | 산업안전 | 제52조 | 산업안전보건법 |
| 10 | 노동조합 가입·불이익 | 노조 | 제81조 | 노동조합 및 노동관계조정법 |

## 최근 결과 요약 (2026-02-19 기준)

- **평균 점수**: 약 59/100 (이전 실행 기준)
- **주요 실패 요인**
  1. **시나리오 1**: 이슈 분류 실패(0점) — 상황 문장에 "해고"가 없어 키워드 매칭 실패 후 LLM이 "해당 내용은 제공된 법령 데이터에 없습니다"만 반환.
  2. **시나리오 2, 9**: 체크리스트 0개 — reasoning 모델이 `max_completion_tokens` 한도까지 reasoning만 사용해 실제 content가 비어 JSON 파싱 실패.
  3. **시나리오 8**: 결론에 조문 인용/법률명 미포함.

## 적용한 수정 사항

1. **시나리오 1 키워드 매칭** (`rag/labor_keywords.py`)
   - "나오지 말래요", "나오지 마세요", "나오지 말라" → `해고/징계` 동의어로 추가.
   - 구두로 "나오지 마라"는 식의 해고 상황에서도 키워드 경로로 이슈 분류되도록 함.

2. **체크리스트 0개 시 재시도** (`rag/pipeline.py` step2_checklist)
   - 첫 번째 호출에서 체크리스트가 0개이고 `max_tokens`가 6000 이상 또는 None일 때, `max_tokens=4096`으로 한 번 더 호출.
   - reasoning 모델이 토큰 한도를 reasoning에 다 써서 본문이 비는 경우를 완화.

3. **테스트 스크립트** (`scripts/test_scenarios.py`)
   - 시나리오 1 `expected_issues`: "노조" → "해고/징계"로 수정.
   - 벡터 스토어 준비 완료 메시지에서 이모지 제거(Windows cp949 인코딩 오류 방지).

## 점수 산정 (스크립트 기준)

- 이슈 분류 성공: 20점  
- 체크리스트 생성: 20점  
- 결론 생성: 20점  
- 예상 조문 포함: 최대 20점  
- 예상 법률 포함: 최대 20점  

60점 이상 PASS, 40~59 WARN, 40 미만 FAIL로 표시됩니다.

## 재검증 권장

수정 반영 후 아래처럼 다시 실행해 10개 시나리오 통과 여부를 확인하면 됩니다.

```bash
python scripts/test_scenarios.py
```

결과 JSON의 `average_score`와 각 `results[].score`, `missing_articles`, `missing_laws`를 확인하세요.
