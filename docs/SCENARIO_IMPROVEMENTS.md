# 노동법 챗봇 시나리오 테스트 개선 사항

## 개선 완료 사항

### 1. 이슈 카테고리 확장
- **문제**: 시나리오 6-10에서 필요한 이슈 카테고리(산재, 산업안전, 노조, 최저임금, 남녀고용평등, 육아휴직)가 `PRIMARY_ISSUES`에 없음
- **해결**: `rag/labor_keywords.py`의 `PRIMARY_ISSUES`에 다음 이슈 추가:
  - `산재` (산업재해보상보험법)
  - `산업안전` (산업안전보건법)
  - `노조` (노동조합 및 노동관계조정법)
  - `최저임금` (최저임금법)
  - `남녀고용평등` (남녀고용평등법)
  - `육아휴직` (남녀고용평등법)
  - `고용보험` (고용보험법)

### 2. 이슈 동의어 확장
- **문제**: 일상 표현이 이슈로 매핑되지 않음
- **해결**: `ISSUE_SYNONYMS`에 다음 동의어 추가:
  - 산재: "산재", "산업재해", "업무상재해", "업무상재해보상", "산재보험"
  - 산업안전: "산업안전", "작업중지", "작업중지권", "안전보건"
  - 노조: "노조", "노동조합", "부당노동행위", "단체교섭"
  - 최저임금: "최저임금", "수습기간"
  - 남녀고용평등: "남녀고용평등", "성차별"
  - 육아휴직: "육아휴직"

### 3. 프롬프트 개선
- **문제**: 이슈 분류 프롬프트에서 새로운 이슈 카테고리를 명시하지 않음
- **해결**: `rag/prompts.py`의 `system_issue_classification()`에서 허용 이슈 목록에 새로운 카테고리 추가

## 시나리오별 예상 문제점 및 개선 방안

### 시나리오 1: 부당해고 및 해고 예고
- **예상 조문**: 근로기준법 제23조, 제26조, 제27조
- **예상 문제**: 해고 예고와 서면 통지 요건을 모두 언급해야 함
- **개선 방안**: 체크리스트에서 "해고 예고 기간", "서면 통지 여부"를 별도 질문으로 분리

### 시나리오 2: 직장 내 괴롭힘
- **예상 조문**: 근로기준법 제76조의2, 제76조의3
- **예상 문제**: 괴롭힘의 구체적 유형(인격 모독, 면박 등)을 확인해야 함
- **개선 방안**: 체크리스트에서 괴롭힘 유형을 구체적으로 질문

### 시나리오 3: 임금 체불 및 퇴직금 지급 기한
- **예상 조문**: 근로기준법 제36조, 근로자퇴직급여 보장법 제9조
- **예상 문제**: 두 법률의 조문을 모두 인용해야 함
- **개선 방안**: `step3_conclusion`에서 관련 법률을 모두 검색하도록 개선 (이미 구현됨)

### 시나리오 4: 포괄임금제와 연장근로 수당
- **예상 조문**: 근로기준법 제56조
- **예상 문제**: 포괄임금으로 정한 시간 초과 시 차액 지급 의무를 명확히 설명해야 함
- **개선 방안**: 판례/해석례 데이터를 더 적극적으로 활용 (이미 `_add_precedents_and_explanations`에서 구현됨)

### 시나리오 5: 5인 미만 사업장 적용 범위
- **예상 조문**: 근로기준법 제11조, 시행령 별표 1
- **예상 문제**: 시행령의 별표를 인용해야 함
- **개선 방안**: 시행령/시행규칙도 검색 범위에 포함 (이미 `ALL_LABOR_LAW_SOURCES`에 포함되어 있으나, 시행령/규칙 소스도 명시적으로 추가 필요)

### 시나리오 6: 최저임금 및 수습기간
- **예상 조문**: 최저임금법 제5조
- **예상 문제**: 
  1. "1년 이상 계약 기간" 조건 확인
  2. "단순 노무 업무 여부" 확인
  3. 최저임금법이 벡터 스토어에 포함되어 있는지 확인 필요
- **개선 방안**: 
  - 체크리스트에서 계약 기간과 업무 유형을 명확히 질문
  - 최저임금법이 동기화되어 있는지 확인 (`scripts/sync_laws.py`에서 `LABOR_LAW_QUERIES`에 포함되어 있는지 확인)

### 시나리오 7: 육아휴직 및 불이익 금지
- **예상 조문**: 남녀고용평등법 제19조
- **예상 문제**: 
  1. "동일 업무 또는 동일 임금 수준의 직무 복귀" 의무를 명확히 언급해야 함
  2. 남녀고용평등법이 벡터 스토어에 포함되어 있는지 확인 필요
- **개선 방안**: 
  - 결론 생성 시 복귀 의무를 명시적으로 언급하도록 프롬프트 개선
  - 남녀고용평등법이 동기화되어 있는지 확인

### 시나리오 8: 산재 신청 및 사업주 동의
- **예상 조문**: 산업재해보상보험법 제37조
- **예상 문제**: 
  1. "사업주 동의 불필요" 원칙을 명확히 설명해야 함
  2. 근로복지공단 접수 안내 필요
  3. 산재보험법이 벡터 스토어에 포함되어 있는지 확인 필요
- **개선 방안**: 
  - 결론 생성 시 사업주 동의 불필요와 신청 절차를 명확히 언급
  - 산재보험법이 동기화되어 있는지 확인

### 시나리오 9: 산업안전 및 작업중지권
- **예상 조문**: 산업안전보건법 제52조
- **예상 문제**: 
  1. "작업중지권"을 명확히 언급해야 함
  2. "불이익 금지"를 명확히 언급해야 함
  3. 산업안전보건법이 벡터 스토어에 포함되어 있는지 확인 필요
- **개선 방안**: 
  - 결론 생성 시 작업중지권과 불이익 금지를 명확히 언급
  - 산업안전보건법이 동기화되어 있는지 확인

### 시나리오 10: 노동조합 가입 및 불이익
- **예상 조문**: 노동조합법 제81조
- **예상 문제**: 
  1. "부당노동행위"로 규정해야 함
  2. 노동위원회 구제 절차를 안내해야 함
  3. 노조법이 벡터 스토어에 포함되어 있는지 확인 필요
- **개선 방안**: 
  - 결론 생성 시 부당노동행위와 구제 절차를 명확히 언급
  - 노조법이 동기화되어 있는지 확인

## 추가 개선 사항

### 1. 법률별 조문 검색 우선순위
- **문제**: 여러 법률에서 검색할 때 관련 법률을 우선시하지 않음
- **개선 방안**: 이슈별로 관련 법률을 매핑하고, 해당 법률을 우선 검색
  ```python
  ISSUE_TO_LAW_MAPPING = {
      "최저임금": [SOURCE_MIN_WAGE_LAW, SOURCE_LAW],
      "산재": [SOURCE_INDUSTRIAL_ACCIDENT_LAW, SOURCE_SAFETY_LAW],
      "산업안전": [SOURCE_SAFETY_LAW],
      "노조": [SOURCE_UNION_LAW],
      "남녀고용평등": [SOURCE_GENDER_EQUALITY_LAW],
      "육아휴직": [SOURCE_GENDER_EQUALITY_LAW],
      "퇴직금": [SOURCE_RETIREMENT_LAW, SOURCE_LAW],
  }
  ```

### 2. 체크리스트 질문 개선
- **문제**: 특정 법률의 요건(예: 최저임금법의 "1년 이상 계약", "단순 노무 업무")을 확인하지 않음
- **개선 방안**: 이슈별로 필수 확인 사항을 정의하고 체크리스트에 반영
  - 최저임금: 계약 기간, 업무 유형
  - 육아휴직: 복귀 후 직무 보장
  - 산재: 사업주 동의 불필요
  - 작업중지권: 불이익 금지

### 3. 결론 생성 시 법률명 명시
- **문제**: 조문만 인용하고 법률명을 명시하지 않음
- **개선 방안**: 이미 `system_conclusion` 프롬프트에 "법률명 포함" 지시가 있으나, 더 명확히 강조 필요

### 4. 벡터 스토어 동기화 확인
- **문제**: 모든 법률이 벡터 스토어에 포함되어 있는지 확인 필요
- **개선 방안**: `scripts/sync_laws.py`의 `LABOR_LAW_QUERIES`에 다음 법률이 포함되어 있는지 확인:
  - 최저임금법
  - 근로자퇴직급여 보장법
  - 남녀고용평등과 일·가정 양립 지원에 관한 법률
  - 산업안전보건법
  - 산업재해보상보험법
  - 노동조합 및 노동관계조정법

## 테스트 실행 방법

```bash
python scripts/test_scenarios.py
```

결과는 `scenario_test_results_YYYYMMDD_HHMMSS.json` 파일로 저장됩니다.

## 다음 단계

1. 시뮬레이션 결과 분석
2. 누락된 조문/법률 패턴 파악
3. 이슈별 법률 매핑 구현
4. 체크리스트 질문 개선
5. 결론 생성 프롬프트 개선
